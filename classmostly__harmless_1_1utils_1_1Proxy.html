<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MostlyHarmless: mostly_harmless::utils::Proxy&lt; T &gt; Class Template Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">MostlyHarmless<span id="projectnumber">&#160;0.0.1</span>
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('classmostly__harmless_1_1utils_1_1Proxy.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="classmostly__harmless_1_1utils_1_1Proxy-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">mostly_harmless::utils::Proxy&lt; T &gt; Class Template Reference<span class="mlabels"><span class="mlabel final">final</span></span></div></div>
</div><!--header-->
<div class="contents">

<p>Helper class for managing lifetimes of captured references in a lambda.  
 <a href="#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="mostlyharmless__Proxy_8h_source.html">mostlyharmless_Proxy.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a26cb77aa7c2d1ce51b821bb707f4115d" id="r_a26cb77aa7c2d1ce51b821bb707f4115d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a26cb77aa7c2d1ce51b821bb707f4115d">Proxy</a> (Private, T *toWrap)</td></tr>
<tr class="separator:a26cb77aa7c2d1ce51b821bb707f4115d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa4c1e7ee5c7ef835536f00fe1e1373f6" id="r_aa4c1e7ee5c7ef835536f00fe1e1373f6"><td class="memItemLeft" align="right" valign="top">T *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa4c1e7ee5c7ef835536f00fe1e1373f6">getWrapped</a> () noexcept</td></tr>
<tr class="separator:aa4c1e7ee5c7ef835536f00fe1e1373f6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae010b13ffb7c4dafea8e44fb76df63c7" id="r_ae010b13ffb7c4dafea8e44fb76df63c7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae010b13ffb7c4dafea8e44fb76df63c7">null</a> () noexcept</td></tr>
<tr class="separator:ae010b13ffb7c4dafea8e44fb76df63c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa833e5e77573b804cfdda986d6292459" id="r_aa833e5e77573b804cfdda986d6292459"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa833e5e77573b804cfdda986d6292459">isValid</a> () noexcept</td></tr>
<tr class="separator:aa833e5e77573b804cfdda986d6292459"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-static-methods" name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:a70a880a8513f3b0905df4648f73d7472" id="r_a70a880a8513f3b0905df4648f73d7472"><td class="memItemLeft" align="right" valign="top">static std::shared_ptr&lt; <a class="el" href="classmostly__harmless_1_1utils_1_1Proxy.html">Proxy</a>&lt; T &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a70a880a8513f3b0905df4648f73d7472">create</a> (T *toWrap) noexcept</td></tr>
<tr class="separator:a70a880a8513f3b0905df4648f73d7472"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><div class="compoundTemplParams">template&lt;typename T&gt;<br />
class mostly_harmless::utils::Proxy&lt; T &gt;</div><p>Helper class for managing lifetimes of captured references in a lambda. </p>
<p>Take a scenario where you have a timer thread, which relies on some member variable being valid - for example, </p><div class="fragment"><div class="line"><span class="keyword">class </span>Something final {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    Something() {</div>
<div class="line">        <span class="keyword">auto</span> timerCallback = [<span class="keyword">this</span>]() -&gt; <span class="keywordtype">void</span> {</div>
<div class="line">            ++m_callCount;</div>
<div class="line">        };</div>
<div class="line">        m_timer.action = std::move(timerCallback);</div>
<div class="line">        m_timer.run(100);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    std::atomic&lt;int&gt; m_callCount{ 0 };</div>
<div class="line">    <a class="code hl_class" href="classmostly__harmless_1_1utils_1_1Timer.html">mostly_harmless::utils::Timer</a> m_timer;</div>
<div class="line">};</div>
<div class="ttc" id="aclassmostly__harmless_1_1utils_1_1Timer_html"><div class="ttname"><a href="classmostly__harmless_1_1utils_1_1Timer.html">mostly_harmless::utils::Timer</a></div><div class="ttdef"><b>Definition</b> mostlyharmless_Timer.h:10</div></div>
</div><!-- fragment --><p>Now, lets say between calls to our timer action, our instance of <code>Something</code> gets destroyed - but the timer callback is still running. In this case, we have a segfault, as <code>this == nullptr</code>. This comes up fairly often with timers, and is a massive PITA.</p>
<p>The use case for <a class="el" href="classmostly__harmless_1_1utils_1_1Proxy.html" title="Helper class for managing lifetimes of captured references in a lambda.">Proxy</a> then, is to be able to reliably check if the captured variables are still valid. This works by constructing a shared_ptr to some "Proxy" class with a pointer to the data you want to check, and ensuring its lifecycle matches that of the wrapped pointer. When your wrapped object is destroyed, make sure to call <code><a class="el" href="#ae010b13ffb7c4dafea8e44fb76df63c7">null()</a></code> on the proxy, to invalidate its pointer member. You can then capture the shared_ptr via copy to your timer callback, which will ensure that while the generated closure for the lambda is alive, so is our proxy. Finally, in your callback, you can simply call <code>theProxyInstance.isValid()</code> to check whether the wrapped pointer is still valid, and bail if it isn't. Putting that together for our earlier example then:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>Something final {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    Something() {</div>
<div class="line">        m_proxy = <a class="code hl_function" href="#a70a880a8513f3b0905df4648f73d7472">mostly_harmless::utils::Proxy&lt;Something&gt;::create</a>(<span class="keyword">this</span>);</div>
<div class="line">        <span class="keyword">auto</span> proxyCopy = m_proxy;</div>
<div class="line">        <span class="keyword">auto</span> timerCallback = [<span class="keyword">this</span>, proxyCopy]() -&gt; <span class="keywordtype">void</span> {</div>
<div class="line">            <span class="keywordflow">if</span>(!proxyCopy-&gt;isValid()) {</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line">            }</div>
<div class="line">            ++m_callCount;</div>
<div class="line">        };</div>
<div class="line">        m_timer.action = std::move(timerCallback);</div>
<div class="line">        m_timer.run(100);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    ~Something() {</div>
<div class="line">        m_proxy-&gt;null();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    std::shared_ptr&lt;mostly_harmless::utils::Proxy&lt;Something&gt;&gt; m_proxy{ <span class="keyword">nullptr</span> };</div>
<div class="line">    std::atomic&lt;int&gt; m_callCount{ 0 };</div>
<div class="line">    mostly_harmless::utils::Timer m_timer;</div>
<div class="line">};</div>
<div class="ttc" id="aclassmostly__harmless_1_1utils_1_1Proxy_html_a70a880a8513f3b0905df4648f73d7472"><div class="ttname"><a href="#a70a880a8513f3b0905df4648f73d7472">mostly_harmless::utils::Proxy::create</a></div><div class="ttdeci">static std::shared_ptr&lt; Proxy&lt; T &gt; &gt; create(T *toWrap) noexcept</div><div class="ttdef"><b>Definition</b> mostlyharmless_Proxy.h:87</div></div>
</div><!-- fragment --> </div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a26cb77aa7c2d1ce51b821bb707f4115d" name="a26cb77aa7c2d1ce51b821bb707f4115d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a26cb77aa7c2d1ce51b821bb707f4115d">&#9670;&#160;</a></span>Proxy()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classmostly__harmless_1_1utils_1_1Proxy.html">mostly_harmless::utils::Proxy</a>&lt; T &gt;::Proxy </td>
          <td>(</td>
          <td class="paramtype">Private</td>          <td class="paramname"><span class="paramname"><em></em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">T *</td>          <td class="paramname"><span class="paramname"><em>toWrap</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel inline">inline</span><span class="mlabel explicit">explicit</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a70a880a8513f3b0905df4648f73d7472" name="a70a880a8513f3b0905df4648f73d7472"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a70a880a8513f3b0905df4648f73d7472">&#9670;&#160;</a></span>create()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static std::shared_ptr&lt; <a class="el" href="classmostly__harmless_1_1utils_1_1Proxy.html">Proxy</a>&lt; T &gt; &gt; <a class="el" href="classmostly__harmless_1_1utils_1_1Proxy.html">mostly_harmless::utils::Proxy</a>&lt; T &gt;::create </td>
          <td>(</td>
          <td class="paramtype">T *</td>          <td class="paramname"><span class="paramname"><em>toWrap</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel inline">inline</span><span class="mlabel static">static</span><span class="mlabel nodiscard">nodiscard</span><span class="mlabel noexcept">noexcept</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Create a std::shared_ptr&lt;Proxy&lt;T&gt;&gt;, wrapping whatever you pass to toWrap. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">toWrap</td><td>a raw pointer to the data you want to wrap. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="aa4c1e7ee5c7ef835536f00fe1e1373f6" name="aa4c1e7ee5c7ef835536f00fe1e1373f6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa4c1e7ee5c7ef835536f00fe1e1373f6">&#9670;&#160;</a></span>getWrapped()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">T * <a class="el" href="classmostly__harmless_1_1utils_1_1Proxy.html">mostly_harmless::utils::Proxy</a>&lt; T &gt;::getWrapped </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel inline">inline</span><span class="mlabel nodiscard">nodiscard</span><span class="mlabel noexcept">noexcept</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Retrieve the pointer this object is wrapping. </p><dl class="section return"><dt>Returns</dt><dd>The wrapped pointer. Make sure to check this for <code>null</code>. </dd></dl>

</div>
</div>
<a id="aa833e5e77573b804cfdda986d6292459" name="aa833e5e77573b804cfdda986d6292459"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa833e5e77573b804cfdda986d6292459">&#9670;&#160;</a></span>isValid()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classmostly__harmless_1_1utils_1_1Proxy.html">mostly_harmless::utils::Proxy</a>&lt; T &gt;::isValid </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel inline">inline</span><span class="mlabel nodiscard">nodiscard</span><span class="mlabel noexcept">noexcept</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Checks whether the wrapped data is still allocated. </p><dl class="section return"><dt>Returns</dt><dd>true if the data is valid, false otherwise. </dd></dl>

</div>
</div>
<a id="ae010b13ffb7c4dafea8e44fb76df63c7" name="ae010b13ffb7c4dafea8e44fb76df63c7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae010b13ffb7c4dafea8e44fb76df63c7">&#9670;&#160;</a></span>null()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classmostly__harmless_1_1utils_1_1Proxy.html">mostly_harmless::utils::Proxy</a>&lt; T &gt;::null </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel inline">inline</span><span class="mlabel noexcept">noexcept</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>nulls the wrapped pointer - make SURE you call this when whatever data your proxy is wrapping gets destroyed! </p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>/home/runner/work/mostly-harmless/mostly-harmless/include/mostly_harmless/utils/<a class="el" href="mostlyharmless__Proxy_8h_source.html">mostlyharmless_Proxy.h</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacemostly__harmless.html">mostly_harmless</a></li><li class="navelem"><a class="el" href="namespacemostly__harmless_1_1utils.html">utils</a></li><li class="navelem"><a class="el" href="classmostly__harmless_1_1utils_1_1Proxy.html">Proxy</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
